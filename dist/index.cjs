"use strict";var U=Object.create;var d=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var $=(e,t)=>{for(var o in t)d(e,o,{get:t[o],enumerable:!0})},R=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of V(t))!W.call(e,s)&&s!==o&&d(e,s,{get:()=>t[s],enumerable:!(r=B(t,s))||r.enumerable});return e};var u=(e,t,o)=>(o=e!=null?U(F(e)):{},R(t||!e||!e.__esModule?d(o,"default",{value:e,enumerable:!0}):o,e)),J=e=>R(d({},"__esModule",{value:!0}),e);var Z={};$(Z,{log:()=>E});module.exports=J(Z);var S=u(require("express"),1);var b={};$(b,{contactSubmissions:()=>f,insertContactSchema:()=>h});var n=require("drizzle-orm/pg-core"),T=require("drizzle-zod"),i=require("zod"),f=(0,n.pgTable)("contact_submissions",{id:(0,n.serial)("id").primaryKey(),name:(0,n.text)("name").notNull(),email:(0,n.text)("email").notNull(),company:(0,n.text)("company"),phone:(0,n.text)("phone"),industry:(0,n.text)("industry"),businessNeeds:(0,n.text)("business_needs"),technologies:(0,n.text)("technologies"),message:(0,n.text)("message"),inquiryType:(0,n.text)("inquiry_type"),createdAt:(0,n.timestamp)("created_at").defaultNow()}),h=(0,T.createInsertSchema)(f,{name:i.z.string().min(2,"Name must be at least 2 characters"),email:i.z.string().email("Please enter a valid email address"),company:i.z.string().optional(),phone:i.z.string().optional(),industry:i.z.string().optional(),businessNeeds:i.z.string().optional(),technologies:i.z.string().optional(),message:i.z.string().optional(),inquiryType:i.z.enum(["expert","proposal"]).optional()}).omit({id:!0,createdAt:!0});var N=require("drizzle-orm/node-postgres"),_=u(require("pg"),1);var{Pool:G}=_.default;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var H=new G({connectionString:process.env.DATABASE_URL}),O=(0,N.drizzle)(H,{schema:b});var x=class{async createContactSubmission(t){let[o]=await O.insert(f).values(t).returning();return o}},j=new x;var p=require("zod");var K={validation:p.z.object({message:p.z.string(),field:p.z.string().optional()}),internal:p.z.object({message:p.z.string()})},v={contact:{submit:{method:"POST",path:"/api/contact",input:h,responses:{201:p.z.custom(),400:K.validation}}}};var A=require("zod");async function I(e,t){return t.post(v.contact.submit.path,async(o,r)=>{try{let s=v.contact.submit.input.parse(o.body),c=await j.createContactSubmission(s);r.status(201).json(c)}catch(s){if(s instanceof A.z.ZodError)return r.status(400).json({message:s.errors[0].message,field:s.errors[0].path.join(".")});throw s}}),await X(),e}async function X(){console.log("Server initialized.")}var P=u(require("express"),1),C=u(require("fs"),1),g=u(require("path"),1);function z(e){let t=g.default.join(process.cwd(),"dist","public");console.log(`Attempting to serve static files from: ${t}`),console.log(`process.cwd() is: ${process.cwd()}`),console.log(`__dirname is: ${__dirname}`);try{let o=C.default.readdirSync(g.default.join(process.cwd(),"dist"));console.log(`Contents of dist directory: ${o.join(", ")}`)}catch(o){console.error("Could not read dist directory:",o)}if(!C.default.existsSync(t))throw new Error(`Could not find the build directory: ${t}, make sure to build the client first`);e.use(P.default.static(t)),e.get("/{*path}",(o,r)=>{r.sendFile(g.default.resolve(t,"index.html"))})}var q=require("http"),w=u(require("cors"),1),a=(0,S.default)(),D=(0,q.createServer)(a),L={origin:function(e,t){if(!e||["http://localhost:5173","http://localhost:3000","https://automataxpro.site","https://*.vercel.app",/\.vercel\.app$/].some(r=>typeof r=="string"?e===r:r instanceof RegExp?r.test(e):!1))return t(null,!0);t(new Error("Not allowed by CORS"))},credentials:!0,methods:["GET","POST","PUT","DELETE","OPTIONS"],allowedHeaders:["Content-Type","Authorization","X-Requested-With"]};a.use((0,w.default)(L));a.use((e,t,o)=>{if(e.method==="OPTIONS")return(0,w.default)(L)(e,t,o);o()});a.use(S.default.json({verify:(e,t,o)=>{e.rawBody=o}}));a.use(S.default.urlencoded({extended:!1}));function E(e,t="express"){let o=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${o} [${t}] ${e}`)}a.use((e,t,o)=>{let r=Date.now(),s=e.path,c,y=t.json;t.json=function(m,...l){return c=m,y.apply(t,[m,...l])},t.on("finish",()=>{let m=Date.now()-r;if(s.startsWith("/api")){let l=`${e.method} ${s} ${t.statusCode} in ${m}ms`;c&&(l+=` :: ${JSON.stringify(c)}`),E(l)}}),o()});(async()=>{await I(D,a),a.use((o,r,s,c)=>{let y=o.status||o.statusCode||500,m=o.message||"Internal Server Error";return console.error("Internal Server Error:",o),s.headersSent?c(o):s.status(y).json({message:m})}),z(a);let e=process.env.PORT||3e3,t=!0;t&&console.log("Starting server in production mode"),D.listen(e,"0.0.0.0",()=>{E(`serving on port ${e}`),console.log(`Server is running on port ${e}`),console.log(`Environment: ${t?"production":"development"}`)})})();0&&(module.exports={log});
